(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{67:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"玩玩react，撸一个pwa版本的知乎日报"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#玩玩react，撸一个pwa版本的知乎日报","aria-hidden":"true"}},[t._v("#")]),t._v(" 玩玩React，撸一个pwa版本的知乎日报")]),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[t._v("#")]),t._v(" 前言")]),s("p",[t._v("看了一眼上一篇博客，已经有一年多没有写博客了。为了证明博客还活着，赶紧更新一篇。")]),s("p",[t._v("太久没写博文，不知道写什么。因为我自己一直看知乎，很多段子都是上面学习的，近两年业务开发一直写的Vue，所以我决定写一个React的知乎日报。")]),s("h2",{attrs:{id:"准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备工作","aria-hidden":"true"}},[t._v("#")]),t._v(" 准备工作")]),s("ol",[s("li",[s("p",[t._v("知乎日报api，已经有人分析过了，知乎日报 API 分析；当然这次我准备做纯前端的，所以会有跨域，所以使用了一个别人现成的，知乎日报 API 分析（解决跨域精简版）")])]),s("li",[s("p",[t._v("获取到api之后，尝试了一下接口，完美返回数据；尝试渲染一下，纳尼，图片403出不来。google一下，因为知乎做了referer检查，简单处理方式就是加"),s("code",[t._v('<meta name="referrer" content="never">')]),t._v("这个meta标签")])]),s("li",[s("p",[t._v("http请求封装，因为比较习惯了axios，所以封装了一下。按照个人习惯封装了一个request.js和一个urls.js，request.js主要是做请求的拦截处理，urls.js里面包含所有的业务api地址，于是在saga里面可以直接使用request(urls.xxx, params)进行请求。")])])]),s("h2",{attrs:{id:"页面目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#页面目标","aria-hidden":"true"}},[t._v("#")]),t._v(" 页面目标")]),s("p",[t._v("这次的页面准备做的简单点，只有一个列表页和一个详情页，因为这也是我最常使用的内容。")]),s("p",[t._v("对于一些基本的组件，这次直接使用了antd-mobile的相关组件，有：轮播图、loading图标等等，这里就不多做介绍了，主要还是看API。")]),s("h3",{attrs:{id:"原生实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原生实现","aria-hidden":"true"}},[t._v("#")]),t._v(" 原生实现")]),s("p",[t._v("为了让我们的h5更像一个原生app，我们需要做一些常用的手势操作，主要做了下拉刷新（使用antd-mobile）、下滑改变title和titleBar的背景色（监听scroll事件）、滑动返回（使用hammerjs）。")]),s("p",[t._v("此外，为了模拟app打开的加载图，需要使用ios的splash加载图，主要是设置meta标签的，具体尺寸可以参考"),s("a",{attrs:{href:"https://developer.apple.com/ios/human-interface-guidelines/icons-and-images/launch-screen/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.apple.com/ios/human-interface-guidelines/icons-and-images/launch-screen/")])]),s("h2",{attrs:{id:"优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 优化")]),s("p",[t._v("对于pwa应用，必要的优化还是需要的，这次主要采用了这么一些简单的手段")]),s("h3",{attrs:{id:"详情页css样式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#详情页css样式","aria-hidden":"true"}},[t._v("#")]),t._v(" 详情页css样式")]),s("p",[t._v("因为知乎日报的详情接口会返回css的样式，为了保持样式一致性，直接采用这个返回的css文件，通过动态载入的方式进行插入。当然还要注意几点：")]),s("ol",[s("li",[s("p",[t._v("为了保证首次加载就有样式，直接在html写入css，动态加载的时候判断该link是否已经存在，如果存在就不再插入css的link")])]),s("li",[s("p",[t._v("知乎返回的css地址是http的，但是也支持https，需要自己正则替换成https")])])]),s("h3",{attrs:{id:"懒加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#懒加载","aria-hidden":"true"}},[t._v("#")]),t._v(" 懒加载")]),s("p",[t._v("图片懒加载和路由懒加载。图片懒加载就不细说了，都有成熟的组件可以直接使用；路由懒加载，因为我使用的是react-router-v4，所以建议采用react-loadable的解决方案，当然本质还是webpack的code split。")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// router/index.js")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Loadable "),s("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'react-loadable'")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Loading "),s("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'@/components/Loading/Loading'")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 加载过程展示内容")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{attrs:{class:"token function-variable function"}},[t._v("createComponent")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" path "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("Loadable")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  loader"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[t._v("`@/pages/")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("path"),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{attrs:{class:"token string"}},[t._v("`")])]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 必须使用字符串变量")]),t._v("\n  loading"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Loading\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// components/Loading/Loading.js")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),s("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'react'")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" LoadingBar "),s("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'@/components/Loading/LoadingBar'")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("LoadingComponent")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" isLoading"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isLoading"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Handle the loading state")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("LoadingBar "),s("span",{attrs:{class:"token operator"}},[t._v("/")]),s("span",{attrs:{class:"token operator"}},[t._v(">")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Handle the error state")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("div style"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" paddingTop"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'200px'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" textAlign"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'center'")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        Sorry"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" there was a problem loading the page"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n      "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),s("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("h3",{attrs:{id:"vw适配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vw适配","aria-hidden":"true"}},[t._v("#")]),t._v(" vw适配")]),s("p",[t._v("因为我们的应用主要是在手机端使用的，所以针对不同分辨率还是需要适配处理的。这里采用的vw的适配方案，主要借助的是postcss-px-to-viewport，可以做到将px转化为vw，当然你需要在"),s("code",[t._v("postcssrc.js")]),t._v("进行简单配置：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token string"}},[t._v("'postcss-px-to-viewport'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      viewportWidth"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("750")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      viewportHeight"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1334")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      unitPrecision"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("3")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      viewportUnit"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'vw'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      selectorBlackList"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token string"}},[t._v("'.ignore'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'.hairlines'")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      minPixelValue"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      mediaQuery"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("p",[t._v("其他的postcss插件就不一一介绍了，根据需要自己添加吧。要注意的是，为了解决vw的兼容性问题，需要hack一下，主要是解决IE的问题。我使用的是viewport-units-buggyfill，采用css的content属性进行hack，需要注意的是，img没有content会带来问题，所以你要强制设置img的content为normal。")]),s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{attrs:{class:"token selector"}},[t._v("img")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token property"}},[t._v("content")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" normal "),s("span",{attrs:{class:"token important"}},[t._v("!important")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("h3",{attrs:{id:"缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存","aria-hidden":"true"}},[t._v("#")]),t._v(" 缓存")]),s("p",[t._v("除了service-wroker缓存js、css等资源文件，对于请求内容也需要做一下缓存。")]),s("p",[t._v("因为是纯web的项目，这边就使用localStorage缓存了必要的请求结果。")]),s("ol",[s("li",[s("p",[t._v("历史列表数据，根据date为key进行缓存")])]),s("li",[s("p",[t._v("详情数据，根据id为key进行缓存")])]),s("li",[s("p",[t._v("localStorage大小有限制，一般为5mb，如果超过，需要try-catch，并把localStorage清空")])])]),s("h2",{attrs:{id:"react-vs-vue个人感受"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react-vs-vue个人感受","aria-hidden":"true"}},[t._v("#")]),t._v(" React vs Vue个人感受")]),s("p",[t._v("既然决定了用React写（上次自己写React的demo还是2年前），当然要用下全家桶，顺便和Vue的比较一下。")]),s("p",[t._v("React：react+react-router+react-redux")]),s("p",[t._v("Vue: vue+vue-router+vuex")]),s("h3",{attrs:{id:"路由。react-router用的v4版本，vue-router用的3-x。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由。react-router用的v4版本，vue-router用的3-x。","aria-hidden":"true"}},[t._v("#")]),t._v(" 路由。react-router用的v4版本，vue-router用的3.x。")]),s("ol",[s("li",[s("p",[t._v("路由匹配。react-router必须借助"),s("code",[t._v("<Switch>")]),t._v("组件，否则所有匹配的路由都会被渲染出来，还是有点懵逼的")])]),s("li",[s("p",[t._v("路由懒加载。因为SPA应用，为了加速首屏，路由懒加载是必不可少的，react-router的懒加载一般是借助三方的(?)，在v4版本，借助react-loadable这个库，实现加载中和加载具体页面指向不同组件，不同的状态展示不同的组件，感觉逻辑上更出色，vue-router如果需要实现加载中的一些显示，一般来说是借助beforeRoute这些钩子函数实现的，个人感觉还是更倾向于react-router这样的")])]),s("li",[s("p",[t._v("router和route。简单来说，就是获取router，进行push、replace操作，以及route，获取path、params这些信息。react-router获取router(也就是history)，需要引入withRouter高阶组件，获取route则是要从props.match中获取，相对而言，vue-router是直接入侵Vue.prototype.$router和Vue.prototype.$route实现的，实际用起来，果断vue爽很多啦")])])]),s("h3",{attrs:{id:"状态管理。react-redux用的5-x，vuex用的3-x。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#状态管理。react-redux用的5-x，vuex用的3-x。","aria-hidden":"true"}},[t._v("#")]),t._v(" 状态管理。react-redux用的5.x，vuex用的3.x。")]),s("ol",[s("li",[s("p",[t._v("redux通过connect把state和dispatch都映射(?)到props中，而state通过最外层的Provider组件递传，怎么说呢，connect操作真的有点烦，vuex一如既往粗暴，放到Vue.prototype.$store下")])]),s("li",[s("p",[t._v("两者都有dispatch(action)->reducer/mutation(commit)->state的概念，我在react-redux上用了redux-saga这个中间件，作用是处理所有异步请求或者state的修改操作，而在reducer环节，直接赋值state，这样会让逻辑更加清晰；而vuex一般是在actions里面做这些异步处理。")])])])])}],!1,null,null,null);a.default=e.exports}}]);