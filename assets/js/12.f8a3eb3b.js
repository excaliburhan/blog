(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{60:function(t,a,s){"use strict";s.r(a);var n=s(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"从去除百度云大文件下载限制到js的对象监听"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从去除百度云大文件下载限制到js的对象监听","aria-hidden":"true"}},[t._v("#")]),t._v(" 从去除百度云大文件下载限制到js的对象监听")]),s("h2",{attrs:{id:"引子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引子","aria-hidden":"true"}},[t._v("#")]),t._v(" 引子")]),s("p",[t._v("前几天，一个朋友在微信上问我，Chrome浏览器审查元素，添加如下代码")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("Object"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'navigator'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("value"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" platform"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("p",[t._v("效果是去除百度云大文件下载的限制，原因是什么？")]),s("p",[t._v("那么，我们就要来看一看"),s("code",[t._v("Object.defineProperty")]),t._v("这个函数了。")]),s("blockquote",[s("p",[t._v("Object.defineProperty(obj, prop, descriptor)")])]),s("h3",{attrs:{id:"传入参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传入参数","aria-hidden":"true"}},[t._v("#")]),t._v(" 传入参数")]),s("ul",[s("li",[t._v("obj: 目标对象")]),s("li",[t._v("prop: 目标属性")]),s("li",[t._v("descriptor: 目标属性所拥有的特性")])]),s("p",[t._v("前两个参数很好理解，重点是第三个参数descriptor。")]),s("h3",{attrs:{id:"descriptor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#descriptor","aria-hidden":"true"}},[t._v("#")]),t._v(" descriptor")]),s("p",[t._v("descriptor有以下的取值：")]),s("ul",[s("li",[t._v("value: 属性值")]),s("li",[t._v("writable: 是否可写，只有在ture的时候可以重写，否则无法更改值")]),s("li",[t._v("configurable: 是否可以设置，总的设置，如果为false，则无法修改(value, writable, configurable)")]),s("li",[t._v("enumerable: 是否可以枚举，为true时，可以通过for...in循环获取")]),s("li",[t._v("get: get函数")]),s("li",[t._v("set: set函数")])]),s("h2",{attrs:{id:"去除百度云限制脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#去除百度云限制脚本","aria-hidden":"true"}},[t._v("#")]),t._v(" 去除百度云限制脚本")]),s("p",[t._v("回到最开始的js代码，对于浏览器而言，"),s("code",[t._v("this = window")]),t._v("，所以可以理解成，把navigator.platform值设置为空，即伪造了platform的值。猜想百度云应该通过这个值来限制用户下载大文件的。")]),s("p",[t._v("如果只是改变value值，那么是否可以用"),s("code",[t._v("navigator.platform = ''")]),t._v("这样的语句改platform的值呢？在控制台输入代码可以得到这样的结果：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("navigator"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("platform "),s("span",{attrs:{class:"token comment"}},[t._v('// "MacIntel" 我的电脑是mac')]),t._v("\nnavigator"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("platform "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("''")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v('// ""')]),t._v("\nnavigator"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("platform "),s("span",{attrs:{class:"token comment"}},[t._v('// "MacIntel"')]),t._v("\n")])]),s("p",[t._v("从结果我们可以推测，navigator对象的"),s("code",[t._v("writable = false")]),t._v("，"),s("code",[t._v("configurable = true")]),t._v("。")]),s("p",[t._v("我自己写了一个TamperMonkey(油猴)的脚本，如果需要可以拿去使用。")]),s("p",[s("a",{attrs:{href:"https://github.com/excaliburhan/LittleScripts/blob/master/DownloadBaiduyunBigFile.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("去除百度云下载限制脚本")]),t._v("。")]),s("p",[t._v("回过头，来看descriptor的get和set函数。首先，这两个属于访问器属性，不能和writable和value同时使用，否则会报错。")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" obj "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" a "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("\nObject"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'a'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[t._v("`value is ")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("a"),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{attrs:{class:"token string"}},[t._v("`")])]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" a\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("set")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[t._v("`new value is ")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("val"),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{attrs:{class:"token string"}},[t._v("`")])]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    a "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" val\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nobj"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),s("span",{attrs:{class:"token comment"}},[t._v("// value is 1, 1")]),t._v("\nobj"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// new value is 2, 2")]),t._v("\n")])]),s("p",[t._v("是不是很酷？这就是实现js对象的监听的关键。")]),s("h2",{attrs:{id:"js的对象监听"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js的对象监听","aria-hidden":"true"}},[t._v("#")]),t._v(" js的对象监听")]),s("h3",{attrs:{id:"实现思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现思路","aria-hidden":"true"}},[t._v("#")]),t._v(" 实现思路")]),s("ol",[s("li",[t._v("将需要监听对象obj和回调函数callback传入构造函数")]),s("li",[t._v("遍历对象obj，通过Object.defineProperty将属性全部定义一遍。getter返回val，setter添加callback")])]),s("h3",{attrs:{id:"实现代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现代码","aria-hidden":"true"}},[t._v("#")]),t._v(" 实现代码")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("Watch")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback\n\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function-variable function"}},[t._v("observe")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" self "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n    Object"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("keys")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("forEach")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" val "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("prop"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      Object"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prop"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" val"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("set")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newVal"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          self"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("callback")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newVal"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prop"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          val "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newVal\n        "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("observe")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("h3",{attrs:{id:"demo代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#demo代码","aria-hidden":"true"}},[t._v("#")]),t._v(" demo代码")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" obj "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  a"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  b"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'test'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  c"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token number"}},[t._v("1")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("2")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("fn")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newVal"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldVal"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prop"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[t._v("`set ")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("prop"),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{attrs:{class:"token string"}},[t._v(" from ")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("oldVal"),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{attrs:{class:"token string"}},[t._v(" to ")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("newVal"),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{attrs:{class:"token string"}},[t._v("`")])]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Watch")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nobj"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// set a from 1 to 2, 2")]),t._v("\nobj"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// set c from 1,2 to 3, 3")]),t._v("\nobj"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token number"}},[t._v("4")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("5")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// set c from 3 to 4,5")]),t._v("\nobj"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b "),s("span",{attrs:{class:"token comment"}},[t._v('// "test"')]),t._v("\n")])]),s("p",[t._v("以上就是一个比较原始的watch函数，用于监听js对象的变化。当然，这种遍历的方法性能消耗比较大，对于较大的js对象并不合适，需要考虑别的实现方法。")])])}],!1,null,null,null);a.default=o.exports}}]);