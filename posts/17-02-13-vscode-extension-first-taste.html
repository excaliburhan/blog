<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>韩小平的博客 | VSCODE插件初体验</title>
    <meta name="description" content="Just A Coder.">
    
    
    <link rel="preload" href="/blog/assets/css/23.styles.cc8c2f9e.css" as="style"><link rel="preload" href="/blog/assets/js/app.1f817541.js" as="script"><link rel="preload" href="/blog/assets/js/2.6d9529a4.js" as="script"><link rel="prefetch" href="/blog/assets/js/12.814f811a.js"><link rel="prefetch" href="/blog/assets/js/1.411138db.js"><link rel="prefetch" href="/blog/assets/js/3.4fdc0d88.js"><link rel="prefetch" href="/blog/assets/js/4.deae28fa.js"><link rel="prefetch" href="/blog/assets/js/5.9fdd6adc.js"><link rel="prefetch" href="/blog/assets/js/6.00a6ab47.js"><link rel="prefetch" href="/blog/assets/js/7.da4f18c9.js"><link rel="prefetch" href="/blog/assets/js/8.913fdfc3.js"><link rel="prefetch" href="/blog/assets/js/9.edf39113.js"><link rel="prefetch" href="/blog/assets/js/10.2f0c9cf4.js"><link rel="prefetch" href="/blog/assets/js/11.615d4175.js"><link rel="prefetch" href="/blog/assets/js/0.cffbc176.js"><link rel="prefetch" href="/blog/assets/js/13.69b37d45.js"><link rel="prefetch" href="/blog/assets/js/14.a0bb1f94.js"><link rel="prefetch" href="/blog/assets/js/15.9690300e.js"><link rel="prefetch" href="/blog/assets/js/16.d94b26bb.js"><link rel="prefetch" href="/blog/assets/js/17.49b0032e.js"><link rel="prefetch" href="/blog/assets/js/18.53f1b6f9.js"><link rel="prefetch" href="/blog/assets/js/19.49c9af97.js"><link rel="prefetch" href="/blog/assets/js/20.d43d8101.js"><link rel="prefetch" href="/blog/assets/js/21.c6d918ad.js"><link rel="prefetch" href="/blog/assets/js/22.3be36221.js">
    <link rel="stylesheet" href="/blog/assets/css/23.styles.cc8c2f9e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/blog/" class="home-link router-link-active"><!----><span class="site-name">
      韩小平的博客
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/posts/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/links/" class="nav-link">友链</a></div><a href="https://github.com/excaliburhan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/posts/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/links/" class="nav-link">友链</a></div><a href="https://github.com/excaliburhan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><!----></div><div class="page"><div class="content"><h1 id="vscode插件初体验"><a href="#vscode插件初体验" aria-hidden="true" class="header-anchor">#</a> VSCODE插件初体验</h1><h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2><p>使用vscode也有大半年时间了，从一开始的各种问题到现在渐渐好用。插件维护比sublime好，速度能秒atom，这大概就是现在离不开vscode的原因吧。虽然它还有不少问题，比如代码高亮和智能提示，尤其是在vue这种template文件中，完全没有用！</p><p>不过今天不是来吐槽这个的。虽然说到vscode的插件比sublime维护方便，但是插件数量还是比不上的，毕竟时间还不长。比如我一直很喜欢的作者信息生成的插件，什么名字忘记了，毕竟卸载好久了...主要就是设置了作者姓名，邮箱这些信息之后，在顶部自动生成包括作者/邮箱/时间还有其他自定义的信息。</p><p>在vscode插件市场找了半天也没找到，决定自己动手撸一个。</p><ul><li>项目地址：<a href="https://github.com/excaliburhan/vscode-author-generator" target="_blank" rel="noopener noreferrer">https://github.com/excaliburhan/vscode-author-generator</a>。</li><li>插件安装：vscode或者市场搜索<code>vscode-author-generator</code>。</li></ul><h2 id="需求准备"><a href="#需求准备" aria-hidden="true" class="header-anchor">#</a> 需求准备</h2><p>首先，确定下这个插件的需求：</p><ul><li>自动生成作者信息，部分信息(作者/邮箱)可配置。</li><li>根据文件类型生成不同注释。</li><li>支持自定义模版。</li></ul><h2 id="其他准备"><a href="#其他准备" aria-hidden="true" class="header-anchor">#</a> 其他准备</h2><ul><li><a href="https://code.visualstudio.com/docs/extensionAPI/vscode-api" target="_blank" rel="noopener noreferrer">vscode api文档</a></li><li><a href="https://code.visualstudio.com/docs/tools/vscecli" target="_blank" rel="noopener noreferrer">vscecli 文档</a></li></ul><p>这两个文档在之后的开发会用到，下面会讲到。</p><h2 id="开发插件"><a href="#开发插件" aria-hidden="true" class="header-anchor">#</a> 开发插件</h2><h3 id="_1-vscecli信息"><a href="#_1-vscecli信息" aria-hidden="true" class="header-anchor">#</a> 1. vscecli信息</h3><p>由于后面生成项目要用到发布者信息，我就把vscecli的生成发布者信息部分先讲了，当然后面发布还要用到它。下面是生成发布者信息的步骤，最好还是按照vscecli的文档来做。</p><ul><li>安装：<code>npm install -g vsce</code></li><li>创建：<code>vsce create-publisher (publisher name)</code> (publisher name就是发布者的名字，是你在visualstudio注册的名字，此外你还需要Personal Access Token)</li><li>登陆：<code>vsce login (publisher name)</code> (这一步会要求你输入发布者名字和Personal Access Token)</li></ul><p>至此，本地会记住你的信息，如果你需要更换用户，也可以使用<code>vsce logout</code>登出，并换账号登陆。</p><h3 id="_2-生成项目"><a href="#_2-生成项目" aria-hidden="true" class="header-anchor">#</a> 2. 生成项目</h3><p>这里我使用了官方的generator，生成必要的<code>package.json</code>信息，如果你自己去写，可以参看<a href="https://code.visualstudio.com/docs/extensionAPI/extension-manifest" target="_blank" rel="noopener noreferrer">官网文档</a>。</p><ul><li><code>npm install -g yo generator-code &amp;&amp; yo code</code></li></ul><p><img src="https://static.excaliburhan.com/blog/20170213/COWO3NSOempfVbg695QfgHSA.jpeg" alt="alt"></p><p>可以看到，提供了几种基本插件/主题编写的模版，由于我没学过typescript，这里选择了javascript的插件。</p><p>按部就班填写信息，如果你已经在上一步登陆<code>vsce</code>，这里的publisher name是自动填写的，你也可以手动填写，但保持和你的注册用户名一致。</p><p><img src="https://static.excaliburhan.com/blog/20170213/_YPzqd-46NhRNCdsNROv3yY_.jpeg" alt="alt"></p><p>确认后，会自动使用npm安装依赖，耐心等待一会，项目就生成完毕。</p><p>我这里没有让它自动生成git项目，可以通过<code>git remote add</code>添加你自己的github仓库地址。</p><p><img src="https://static.excaliburhan.com/blog/20170213/4ez3C47KiN2xLoqOAcJ-AKNL.jpeg" alt="alt"></p><p>生成的项目结构大概是这样的，由于功能比较简单，这里只要关心<code>extension.js</code>就可以了，这是我们的主要功能js。</p><h3 id="_3-manifest解释"><a href="#_3-manifest解释" aria-hidden="true" class="header-anchor">#</a> 3. manifest解释</h3><p>vscode的manifest文件，也就是<code>package.json</code>文件，先来看看默认生成的：</p><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vscode-test&quot;</span><span class="token punctuation">,</span>  // 插件名字
    <span class="token property">&quot;displayName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vscode-test&quot;</span><span class="token punctuation">,</span> // 插件显示名字
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.1&quot;</span><span class="token punctuation">,</span>  // 插件版本
    <span class="token property">&quot;publisher&quot;</span><span class="token operator">:</span> <span class="token string">&quot;edwardhjp&quot;</span><span class="token punctuation">,</span>  // 发布者
    <span class="token property">&quot;engines&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;vscode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.5.0&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;categories&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;Other&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;activationEvents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;onCommand:extension.sayHello&quot;</span> // 激活事件，onCommand表示command调用，就是在vscode用`cmd + shift + p`调出来后使用，其他的参看文档。
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./extension&quot;</span><span class="token punctuation">,</span> // 入口文件
    <span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;commands&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token string">&quot;extension.sayHello&quot;</span><span class="token punctuation">,</span>  // `cmd + shift + p`实际执行的command，和上面的激活事件要对应
            <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span> // `cmd + shift + p`调用显示名字
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;postinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./node_modules/vscode/bin/install&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./node_modules/vscode/bin/test&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.3&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;vscode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mocha&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.3.3&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;eslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.6.0&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;@types/node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.0.40&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;@types/mocha&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.2.32&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>基本解释都写在注释里了，根据自己需要修改吧。</p><h3 id="_4-extension-js编写"><a href="#_4-extension-js编写" aria-hidden="true" class="header-anchor">#</a> 4. extension.js编写</h3><pre class="language-js"><code><span class="token keyword">var</span> vscode <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vscode'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 包含vscode所有api的模块</span>

<span class="token keyword">function</span> <span class="token function">activate</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 插件激活事件，必须与package.json的对应</span>
    <span class="token keyword">var</span> disposable <span class="token operator">=</span> vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'extension.sayHello'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Info信息框</span>
        vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showInformationMessage</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    context<span class="token punctuation">.</span>subscriptions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>disposable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
exports<span class="token punctuation">.</span>activate <span class="token operator">=</span> activate<span class="token punctuation">;</span>

<span class="token comment">// 取消插件激活事件</span>
<span class="token keyword">function</span> <span class="token function">deactivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
exports<span class="token punctuation">.</span>deactivate <span class="token operator">=</span> deactivate<span class="token punctuation">;</span>
</code></pre><p>官方的js文件，就是在调用的时候弹一个<code>Hello World!</code>的提示框。原则上你的逻辑都应该在<code>registerCommand</code>的function里面。如果你的逻辑很复杂，建议把逻辑移到外面，合理解构代码。</p><p>你可以在vscode打开项目的目录文件，然后使用<code>F5</code>进行debug模式，vscode会起一个扩展主机给你进行开发。</p><p>但是我的vscode不知道什么原因，扩展主机一直失败。我都是直接把项目拷贝到本地插件目录进行开发的，每次debug都要重启vscode，说多了都是泪～</p><p>如果你知道怎么解决，请告诉我！</p><h3 id="_5-插件发布"><a href="#_5-插件发布" aria-hidden="true" class="header-anchor">#</a> 5. 插件发布</h3><p>又要用到刚才的vscecli了。</p><p>在项目根目录使用：<code>vsce package</code>打包你的插件，会生成一个<code>extensionName-version.vsix</code>的信息文件。</p><p>然后：<code>vsce publish</code>，进行发布，如果成功，会返回类似内容：</p><pre class="language-js"><code>Successfully published publisherName<span class="token punctuation">.</span>extensionName@version<span class="token operator">!</span>
</code></pre><h2 id="尾声"><a href="#尾声" aria-hidden="true" class="header-anchor">#</a> 尾声</h2><p>好了，现在你可以在vscode市场搜索你自己上传的插件了。祝大家写得愉快！</p></div><!----><!----></div></div></div>
    <script src="/blog/assets/js/2.6d9529a4.js" defer></script><script src="/blog/assets/js/app.1f817541.js" defer></script>
  </body>
</html>
