<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>韩小平的博客 | 用nw.js制作一个自己的markdown app</title>
    <meta name="description" content="Just A Coder.">
    
    
    <link rel="preload" href="/blog/assets/css/23.styles.cc8c2f9e.css" as="style"><link rel="preload" href="/blog/assets/js/app.7eb76737.js" as="script"><link rel="preload" href="/blog/assets/js/12.814f811a.js" as="script"><link rel="prefetch" href="/blog/assets/js/1.411138db.js"><link rel="prefetch" href="/blog/assets/js/2.6d9529a4.js"><link rel="prefetch" href="/blog/assets/js/3.4fdc0d88.js"><link rel="prefetch" href="/blog/assets/js/4.deae28fa.js"><link rel="prefetch" href="/blog/assets/js/5.9fdd6adc.js"><link rel="prefetch" href="/blog/assets/js/6.00a6ab47.js"><link rel="prefetch" href="/blog/assets/js/7.da4f18c9.js"><link rel="prefetch" href="/blog/assets/js/8.913fdfc3.js"><link rel="prefetch" href="/blog/assets/js/9.edf39113.js"><link rel="prefetch" href="/blog/assets/js/10.2f0c9cf4.js"><link rel="prefetch" href="/blog/assets/js/11.615d4175.js"><link rel="prefetch" href="/blog/assets/js/0.cffbc176.js"><link rel="prefetch" href="/blog/assets/js/13.69b37d45.js"><link rel="prefetch" href="/blog/assets/js/14.a0bb1f94.js"><link rel="prefetch" href="/blog/assets/js/15.9690300e.js"><link rel="prefetch" href="/blog/assets/js/16.d94b26bb.js"><link rel="prefetch" href="/blog/assets/js/17.49b0032e.js"><link rel="prefetch" href="/blog/assets/js/18.53f1b6f9.js"><link rel="prefetch" href="/blog/assets/js/19.49c9af97.js"><link rel="prefetch" href="/blog/assets/js/20.d43d8101.js"><link rel="prefetch" href="/blog/assets/js/21.c6d918ad.js"><link rel="prefetch" href="/blog/assets/js/22.3be36221.js">
    <link rel="stylesheet" href="/blog/assets/css/23.styles.cc8c2f9e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/blog/" class="home-link router-link-active"><!----><span class="site-name">
      韩小平的博客
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/posts/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/links/" class="nav-link">友链</a></div><a href="https://github.com/excaliburhan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/posts/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/links/" class="nav-link">友链</a></div><a href="https://github.com/excaliburhan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><!----></div><div class="page"><div class="content"><h1 id="用nw-js制作一个自己的markdown-app"><a href="#用nw-js制作一个自己的markdown-app" aria-hidden="true" class="header-anchor">#</a> 用nw.js制作一个自己的markdown app</h1><h2 id="_1-什么是nw-js"><a href="#_1-什么是nw-js" aria-hidden="true" class="header-anchor">#</a> 1. 什么是nw.js</h2><p>nw.js，前身nodeWebkit，顾名思义，是基于node+webkit运行的。加上支持各类npm包，可以让前端很容易通过HTML和JavaScript制作属于自己的客户端app。</p><h2 id="_2-开始使用nw-js"><a href="#_2-开始使用nw-js" aria-hidden="true" class="header-anchor">#</a> 2. 开始使用nw.js</h2><p>首先，你需要下载<a href="http://nwjs.io/" target="_blank" rel="noopener noreferrer">nw.js</a>。一般来说，开发app的时候需要下载sdk版本，集成了devtool，方便调试。而生产环境则应该使用normal版本，因为它更小巧灵活。</p><p>以我使用的v0.17.4(Mac版本为例，下同)为例，将你下载的放入你的开发目录，如nwjs目录下。新建一个package.json，熟悉npm的应该都知道，这是一个配置json文件，而nw.js需要这个文件提供必要的信息。以下是我的markdown编辑器(LittleMD，以下用LittleMD作指代)的配置信息。</p><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> // 入口文件
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LittleMD&quot;</span><span class="token punctuation">,</span>   // 名称
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.2&quot;</span><span class="token punctuation">,</span>   // 版本号
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a markdown app via nwjs&quot;</span><span class="token punctuation">,</span> // 描述
  <span class="token property">&quot;window&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> // nw.js窗口配置
    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LittleMD&quot;</span><span class="token punctuation">,</span> // 入口html的title不存在时，则使用这个
    <span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon.png&quot;</span><span class="token punctuation">,</span> // icon
    <span class="token property">&quot;toolbar&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> // 是否隐藏窗口的工具条
    <span class="token property">&quot;frame&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> // 是否显示外层的框架，如最大化最小化
    <span class="token property">&quot;position&quot;</span><span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> // 初始化位置
    <span class="token property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> // 初始化宽度
    <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">800</span> // 初始化高度
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> // 各类依赖
    <span class="token property">&quot;emojify.js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;gulp-less&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;highlight.js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^9.7.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jquery&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;marked&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.3.6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;phantom-html2pdf&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;phantomjs-prebuilt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.1.12&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;qiniu&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.1.11&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;taboverride&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.3&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>可以看到，<code>package.json</code> 和npm包的配置很像，所以上手也很快，只要记得配置相关的nw.js的配置即可，更多配置请看<a href="http://docs.nwjs.io/en/latest/References/Manifest%20Format/#manifest-format" target="_blank" rel="noopener noreferrer">Manifest文档</a>。</p><p>然后，新建一个index.html，与package.json的入口路径一致，恭喜你，你已经拥有了一个最简单的app。</p><p>当然，此时打开nwjs.app，只会看到一片空白，因为html内容就是空白的。你需要编辑html文件让它呈现内容。当然，在此之前，我们首先建立几个基本目录，构建我们的项目目录。一般来说，需要js/css/images，分别存放js文件/css文件/图片资源文件，最后的结构如图。</p><p><img src="https://o2znrmehg.qnssl.com/ghost/2016/10/09/qq20161009-0-2x-1475999110974.png?imageView2/1/w/300" alt="pic"></p><p>至此，我们的app项目已经有了一个雏形。</p><h2 id="_3-制作一个markdown"><a href="#_3-制作一个markdown" aria-hidden="true" class="header-anchor">#</a> 3. 制作一个markdown</h2><p>经过上一步之后，我们已经有了基本的项目结构了。下面就是着手编辑我们的入口文件 <code>index.html</code> 。</p><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>LittleMD.md<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/css/style.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>body<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>editor<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>preview<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/app.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><p><code>style.css</code> 就是我们的样式文件，<code>app.js</code> 就是我们所需要的js文件。我建议把 <code>app.js</code> 放在body后，而head之间，我们还需要初始化一些nw.js的内容。</p><p>editor是LittleMD的编辑框，preview则是预览区。</p><p>接下来，编写css，让LittleMD有编辑器的样子。</p><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span>PingFang SC, Hiragino Sans GB, Microsoft Yahei, WenQuanYi Micro Hei, sans-serif<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">#body</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">#editor</span> <span class="token punctuation">{</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0 5px<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #F9F9F5<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #2d2d2d<span class="token punctuation">;</span>
  <span class="token property">resize</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">#preview</span> <span class="token punctuation">{</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0 10px<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>你可以采用浮动，然后左右各占50%的写法，不过我建议还是采用flex布局。1是更加简单，2是方便以后扩展(比如增加行号显示)。而且，既然是webkit的内核，你都不需要考虑兼容性，这是nw.js很棒的一点。</p><p>现在打开nwjs.app，你可以看到一个有界面的app了，虽然它还没有功能。</p><p><img src="https://o2znrmehg.qnssl.com/ghost/2016/10/09/qq20161009-1-2x-1476000546973.png?imageView2/1/w/600" alt="pic"></p><p>现在，编写你的js文件。我喜欢采用 <code>app.js</code> 作为入口js的做法，这样可以让你更少地修改 <code>index.html</code> 。利用require各个功能js的做法，利于你将功能分块。</p><p><code>app.js</code></p><pre class="language-javascript"><code><span class="token keyword">const</span> main <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./js/main.js'</span><span class="token punctuation">)</span>
main<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>此外，我们需要main.js，负责页面初始化；editor.js，负责编辑器功能。</p><p><code>main.js</code></p><pre class="language-javascript"><code><span class="token keyword">const</span> editor <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./editor.js'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#editor'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'input click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// reload</span>
        editor<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p><code>editor.js</code></p><pre class="language-javascript"><code><span class="token keyword">const</span> marked <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'marked'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> $ <span class="token operator">=</span> global<span class="token punctuation">.</span>$
<span class="token keyword">const</span> hljs <span class="token operator">=</span> global<span class="token punctuation">.</span>hljs

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    marked<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      highlight<span class="token punctuation">:</span> code <span class="token operator">=&gt;</span> hljs<span class="token punctuation">.</span><span class="token function">highlightAuto</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      gfm<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      tables<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      breaks<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      pedantic<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      sanitize<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      smartLists<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      smartypants<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> preview <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#preview'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> editorDom <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#editor'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> editorDom<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    preview<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token function">marked</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>可能你也注意到了，我在editor.js中引入了一个marked，这是一个npm包，是一个markdown语法的解析器。需要先使用 <code>npm install marked</code> 进行安装。此外，我还引入了 <code>jquery</code> 和 <code>highlight.js</code> 两个库，需要在index.html的head标签中引入。</p><p>个人建议，新建一个vendors目录用来存放引入的库文件，和自己的js进行区分。</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/vendors/jquery-3.1.0.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/vendors/highlight.pack.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
  global<span class="token punctuation">.</span>gui <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nw.gui'</span><span class="token punctuation">)</span> <span class="token comment">// nw.js的gui界面</span>
  global<span class="token punctuation">.</span>window <span class="token operator">=</span> window
  global<span class="token punctuation">.</span>$ <span class="token operator">=</span> $
  global<span class="token punctuation">.</span>hljs <span class="token operator">=</span> hljs
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>现在打开nwjs.app，你会发现，你在编辑框输入，预览区会实时更新内容。当然，现在预览区的样式还十分简陋，你可以根据自己需要编写它的样式。</p><h2 id="_4-如何debug"><a href="#_4-如何debug" aria-hidden="true" class="header-anchor">#</a> 4. 如何debug</h2><p>开发app的时候，免不了需要debug。根据官方的devtool使用方法，你可以在app.js中 <code>init()</code> 函数前加入如下代码。</p><pre class="language-javascript"><code><span class="token keyword">const</span> gui <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nw.gui'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> win <span class="token operator">=</span> gui<span class="token punctuation">.</span>Window<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
win<span class="token punctuation">.</span><span class="token function">showDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>这样，你就会在打开nwjs.app的同时打开一个dev窗口了。</p><h2 id="_5-更多的features"><a href="#_5-更多的features" aria-hidden="true" class="header-anchor">#</a> 5. 更多的features</h2><p>显然，这是的LittleMD是十分简陋的，我们需要加入更多的功能。这里，我对一些功能的实现提供一点思路。</p><ul><li>菜单</li></ul><p>作为一个编辑器，我们还是需要基本的菜单的。参照nw.js的<a href="http://docs.nwjs.io/en/latest/References/Menu/" target="_blank" rel="noopener noreferrer">菜单文档</a>。建立一个 <code>menu.js</code>。</p><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">openFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    editor<span class="token punctuation">.</span><span class="token function">chooseFile</span><span class="token punctuation">(</span><span class="token string">'#openFile'</span><span class="token punctuation">,</span> filename <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      editor<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">initMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> win <span class="token operator">=</span> global<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>Window<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> menubar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">global<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>Menu</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'menubar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> fileMenu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">global<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>Menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// for Mac</span>
    menubar<span class="token punctuation">.</span><span class="token function">createMacBuiltin</span><span class="token punctuation">(</span><span class="token string">'LittleMD'</span><span class="token punctuation">)</span>

    fileMenu<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">global<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>MenuItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'Open...'</span><span class="token punctuation">,</span>
      click<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>openFile<span class="token punctuation">,</span>
      modifiers<span class="token punctuation">:</span> <span class="token string">'cmd'</span><span class="token punctuation">,</span>
      key<span class="token punctuation">:</span> <span class="token string">'o'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">...</span> <span class="token comment">// other code</span>
    menubar<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">global<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>MenuItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'File'</span><span class="token punctuation">,</span>
      submenu<span class="token punctuation">:</span> fileMenu<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    win<span class="token punctuation">.</span>menu <span class="token operator">=</span> menubar
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p><code>createMacBuiltin</code> 方法会建立一些常用的Mac界面菜单，上例中，我又加入了一个打开文件的菜单，其他功能与此类似。</p><p>这里简单介绍下打开文件的实现，利用了nw.js提供的html5的功能。首先，你需要在 <code>index.html</code> 中加入一个隐藏的input，如下例子。</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">='</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>openFile<span class="token punctuation">'</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>file<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><p>在 <code>editor.js</code> 中加入 <code>chooseFile</code> 方法。</p><pre class="language-javascript"><code><span class="token function">chooseFile</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// save</span>
  <span class="token keyword">const</span> chooser <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
  chooser<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>chooser<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  chooser<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><p>然后在 <code>menu.js</code> 中加入 <code>openFile</code> 方法。</p><pre class="language-javascript"><code><span class="token function">openFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  editor<span class="token punctuation">.</span><span class="token function">chooseFile</span><span class="token punctuation">(</span><span class="token string">'#openFile'</span><span class="token punctuation">,</span> filename <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    editor<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><p>这样，你在File菜单中点击 <code>Open...</code> 就会打开新文件了，而 <code>editor.loadFile</code> 则是将文件内容载入到编辑框中，利用nodejs中fs的readFile很容易搞定，这里就略过了。</p><ul><li>代码高亮</li></ul><p>还记得前面引入的 <code>highlight.js</code> 吗，结合 <code>marked</code> ，可以做到实时 <code>reload</code> 的时候转化为代码高亮的dom结构。具体逻辑参看<a href="https://github.com/chjj/marked" target="_blank" rel="noopener noreferrer">marked highlight</a>。实现代码在上面气势已经给出，就是 <code>reload</code> 中的highlight设置。</p><pre class="language-javascript"><code>highlight<span class="token punctuation">:</span> code <span class="token operator">=&gt;</span> hljs<span class="token punctuation">.</span><span class="token function">highlightAuto</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
</code></pre><p>再打开app看下，是不是有代码高亮了，当然前提是引入相关样式。具体可以参看<a href="https://highlightjs.org/" target="_blank" rel="noopener noreferrer">highlight.js</a>。</p><ul><li>emoji</li></ul><p>一个有逼格的编辑器，怎么能没有emoji。这里采用了<a href="http://www.webpagefx.com/tools/emoji-cheat-sheet/" target="_blank" rel="noopener noreferrer">emoji-cheat-sheet</a>的语法。</p><p>你可以改写marked语法实现 <code>:smile:</code> 到emoji表情的映射，也可以采用别人的库，例如<a href="https://github.com/Ranks/emojify.js" target="_blank" rel="noopener noreferrer">emojify.js</a>。<code>emojify.js</code>定制更方便，当然如果有自己的需要，那还是改写parser更好。</p><p>以下是以 <code>emojify.js</code> 为例写的，在 <code>editor.js</code> 的 <code>reload</code> 结尾加入以下语句即可。</p><pre class="language-javascript"><code>emojify<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>preview<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><ul><li>图片上传</li></ul><p>markdown编辑图片时，如果是本地图片，需要传到第三方的空间，未免麻烦。由于我使用了七牛的cdn，这里以七牛的sdk为例实现了图片上传功能。</p><p>核心功能实现参见<a href="http://o9gnz92z5.bkt.clouddn.com/code/v6/sdk/nodejs.html" target="_blank" rel="noopener noreferrer">七牛sdk</a>。</p><ul><li>导出pdf</li></ul><p>利用 <code>phantomjs</code> 实现，LittleMD采用了一个npm包 <code>phantom-html2pdf</code> 实现了这个功能。当然这个包有不少坑，后面再提。</p><h2 id="_6-一些问题与反思"><a href="#_6-一些问题与反思" aria-hidden="true" class="header-anchor">#</a> 6. 一些问题与反思</h2><p>npm包功能强大，实现很多功能都很方便。但是，很多项目年久失修，缺乏维护，所以，必要时候要学会自己修改源码。比如上面提到的 <code>phantom-html2pdf</code> 这个包，实际使用发现导出的pdf一直是空的。debug之后才发现，由于node版本原因，它依赖的 <code>phantomjs-prebuilt</code> 没有执行文件，而且执行路径也是错误的。修改之后，实现了具体功能。</p><h2 id="_7-最后"><a href="#_7-最后" aria-hidden="true" class="header-anchor">#</a> 7. 最后</h2><p>目前(2016-10-09)已经发布了v0.02版本，欢迎试用并提出你的意见，<a href="https://github.com/excaliburhan/LittleMD/releases" target="_blank" rel="noopener noreferrer">地址</a>。</p></div><!----><!----></div></div></div>
    <script src="/blog/assets/js/12.814f811a.js" defer></script><script src="/blog/assets/js/app.7eb76737.js" defer></script>
  </body>
</html>
