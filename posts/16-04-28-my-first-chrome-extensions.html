<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>韩小平的博客 | 知乎日报Web版 - 我的第一个Chrome插件</title>
    <meta name="description" content="Just A Coder.">
    
    
    <link rel="preload" href="/blog/assets/css/23.styles.cc8c2f9e.css" as="style"><link rel="preload" href="/blog/assets/js/app.1f817541.js" as="script"><link rel="preload" href="/blog/assets/js/17.49b0032e.js" as="script"><link rel="prefetch" href="/blog/assets/js/12.814f811a.js"><link rel="prefetch" href="/blog/assets/js/1.411138db.js"><link rel="prefetch" href="/blog/assets/js/2.6d9529a4.js"><link rel="prefetch" href="/blog/assets/js/3.4fdc0d88.js"><link rel="prefetch" href="/blog/assets/js/4.deae28fa.js"><link rel="prefetch" href="/blog/assets/js/5.9fdd6adc.js"><link rel="prefetch" href="/blog/assets/js/6.00a6ab47.js"><link rel="prefetch" href="/blog/assets/js/7.da4f18c9.js"><link rel="prefetch" href="/blog/assets/js/8.913fdfc3.js"><link rel="prefetch" href="/blog/assets/js/9.edf39113.js"><link rel="prefetch" href="/blog/assets/js/10.2f0c9cf4.js"><link rel="prefetch" href="/blog/assets/js/11.615d4175.js"><link rel="prefetch" href="/blog/assets/js/0.cffbc176.js"><link rel="prefetch" href="/blog/assets/js/13.69b37d45.js"><link rel="prefetch" href="/blog/assets/js/14.a0bb1f94.js"><link rel="prefetch" href="/blog/assets/js/15.9690300e.js"><link rel="prefetch" href="/blog/assets/js/16.d94b26bb.js"><link rel="prefetch" href="/blog/assets/js/18.53f1b6f9.js"><link rel="prefetch" href="/blog/assets/js/19.49c9af97.js"><link rel="prefetch" href="/blog/assets/js/20.d43d8101.js"><link rel="prefetch" href="/blog/assets/js/21.c6d918ad.js"><link rel="prefetch" href="/blog/assets/js/22.3be36221.js">
    <link rel="stylesheet" href="/blog/assets/css/23.styles.cc8c2f9e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/blog/" class="home-link router-link-active"><!----><span class="site-name">
      韩小平的博客
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/posts/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/links/" class="nav-link">友链</a></div><a href="https://github.com/excaliburhan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/posts/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/links/" class="nav-link">友链</a></div><a href="https://github.com/excaliburhan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><!----></div><div class="page"><div class="content"><h1 id="知乎日报web版-我的第一个chrome插件"><a href="#知乎日报web版-我的第一个chrome插件" aria-hidden="true" class="header-anchor">#</a> 知乎日报Web版 - 我的第一个Chrome插件</h1><h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2><p>抱着用Mac也要看知乎日报的崇高想法，偶然间看到<a href="https://github.com/izzyleung" target="_blank" rel="noopener noreferrer">izzyleung</a>总结的知乎api，萌生了自己做一个Chrome插件版的知乎日报。</p><h2 id="chrome插件入门"><a href="#chrome插件入门" aria-hidden="true" class="header-anchor">#</a> Chrome插件入门</h2><p>Chrome插件只需要基础前端就可以入门，当然部分高阶api还是需要研究研究的，好在知乎日报Web版涉及的不多，下面对主要涉及部分做一个简单的介绍。</p><h2 id="chrome插件开发调试"><a href="#chrome插件开发调试" aria-hidden="true" class="header-anchor">#</a> Chrome插件开发调试</h2><ol><li>浏览器url进入插件地址</li><li>加载已解压的扩展程序...打开你的项目地址</li><li>完工，开发！但是前提是你的项目里有必需的一些文件，否则会报错</li></ol><h2 id="chrome插件开发必需文件"><a href="#chrome插件开发必需文件" aria-hidden="true" class="header-anchor">#</a> Chrome插件开发必需文件</h2><ol><li>manifest.json - 清单文件</li><li>popup.html - 其实非必需，但是没有就没有页面</li><li>没了</li></ol><h2 id="manifest文件"><a href="#manifest文件" aria-hidden="true" class="header-anchor">#</a> Manifest文件</h2><p>Chrome插件的核心，是一个json格式的清单文件，必需命名为manifest.json。</p><p>这里突然想起一件事，就是json文件千万别想着写注释，说起来都是泪。当初为了方便记忆，在json文件写了很多注释，结果Chrome一直报错，Google之后才发现<a href="https://plus.google.com/+DouglasCrockfordEsq/posts/RK8qyGVaGSr" target="_blank" rel="noopener noreferrer">json文件不能用注释</a>，借着Google翻译了解了，大致是为了防止利用注释来制定解析规则。</p><ul><li>必须的字段</li></ul><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;知乎日报Web版&quot;</span><span class="token punctuation">,</span> // 插件名称
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span> // 版本信息，才用x.y.z格式，更新时必须版本上升
  <span class="token property">&quot;manifest_version&quot;</span><span class="token operator">:</span> <span class="token number">2</span> // 必须为<span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre><ul><li>最好提供的字段</li></ul><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;知乎日报Chrome扩展Web版本 - Build By 韩小平&quot;</span><span class="token punctuation">,</span> // 插件简介
  <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prod/static/img/icon16.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prod/static/img/icon48.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prod/static/img/icon128.png&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> // icon文件，建议提供<span class="token number">3</span>种不同大小的，Chrome会在不同情况是用对应大小的图片
  <span class="token property">&quot;default_locale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;en&quot;</span> // 默认语言，选择后，目录中必须有_lcoales目录，然后建立语言目录，例如en，再在en里面建立manifest.json清单文件，太复杂了，被我pss了
<span class="token punctuation">}</span>
</code></pre><ul><li>选填字段</li></ul><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;browser_action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prod/static/img/icon16.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;知乎日报Web版&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prod/template/popup.html&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> // 浏览器行为，设置默认的popup页
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;persistent&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;prod/static/js/vendors/zepto-1.1.6.min.js&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> // 背景页，打开扩展就会常驻，主要用于数据传递
  <span class="token property">&quot;options_page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prod/template/options.html&quot;</span><span class="token punctuation">,</span> // 选项页，如果不设置，右键插件<span class="token punctuation">[</span>选项<span class="token punctuation">]</span>会处于置灰状态
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;tabs&quot;</span><span class="token punctuation">,</span> // tab权限
    <span class="token string">&quot;contextMenus&quot;</span><span class="token punctuation">,</span> // 自定义右键菜单，目前并没有用
    <span class="token string">&quot;cookies&quot;</span><span class="token punctuation">,</span> // cookies权限，目前并没有用，目前设置存在localStorage，换电脑不会同步，以后考虑换cookies，因为chrome会同步
    <span class="token string">&quot;notifications&quot;</span><span class="token punctuation">,</span> // 弹出通知，目前并没有用
    <span class="token string">&quot;alarms&quot;</span><span class="token punctuation">,</span> // 提醒，目前并没有用
    <span class="token string">&quot;webNavigation&quot;</span><span class="token punctuation">,</span> // web导航，目前并没有用
    <span class="token string">&quot;\u003Call_urls\u003E&quot;</span> // &lt;all_urls&gt;，最好采用unicode写法，获取对应网址的权限，你也可以写具体网址，如<span class="token operator">:</span> <span class="token string">&quot;https://*.google.com&quot;</span>，当你需要请求对应网址的资源是需要
  <span class="token punctuation">]</span><span class="token punctuation">,</span> // 插件权限，Chrome插件的权限都需要指定，从而使用相对应的Chrome api
  <span class="token property">&quot;web_accessible_resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;prod/static/img/icon16.png&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;prod/static/img/icon48.png&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;prod/static/img/icon128.png&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> // 资源白名单
  <span class="token property">&quot;content_scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> // 脚本白名单
  <span class="token property">&quot;content_security_policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;script-src 'self' https://ssl.google-analytics.com 'unsafe-eval'; object-src 'self'&quot;</span><span class="token punctuation">,</span> // 安全策略
  <span class="token property">&quot;homepage_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/excaliburhan/zhDaily&quot;</span> // 插件主页
<span class="token punctuation">}</span>
</code></pre><h2 id="chrome-api简析"><a href="#chrome-api简析" aria-hidden="true" class="header-anchor">#</a> Chrome api简析</h2><p>我的插件用到Chrome api的地方并不多，理论上你不调用它的api也是完全可以的。</p><p>现在的需求：不重复打开相同的日报页面。如果用原生的location方法，可能会无限打开，所以需要调用chrome.tabs相关方法。用代码举个例子，如下。</p><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">openPage</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    windowId<span class="token punctuation">:</span>chrome<span class="token punctuation">.</span>windows<span class="token punctuation">.</span><span class="token constant">WINDOW_ID_CURRENT</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>tabs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span>
      reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'^chrome.*'</span> <span class="token operator">+</span> fileName <span class="token operator">+</span> <span class="token string">'.html(\\?{0,1})'</span><span class="token operator">+</span> query <span class="token operator">+</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      isOpened <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      tabId<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
      <span class="token comment">// 每个tab注册状态(是否打开/id)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tabs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tabs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          isOpened <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          tabId <span class="token operator">=</span> tabs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOpened<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          query <span class="token operator">=</span> <span class="token string">'?'</span><span class="token operator">+</span> query<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          url<span class="token punctuation">:</span> <span class="token string">'prod/template/'</span><span class="token operator">+</span> fileName <span class="token operator">+</span><span class="token string">'.html'</span><span class="token operator">+</span> query<span class="token punctuation">,</span>
          active<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span>highlighted<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><ol><li>chrome.tabs.query和chrome.windows获取当前打开多有tabs的数组</li><li>正则判断需要打开的页面是否已经打开</li><li>如果没有，利用chrome.tabs.create打开新页面，等同于location.href = 'xxx'</li><li>如果已经打开，利用chrome.tabs.update的方法切换到对应页面</li></ol><p>总体来说，调用api的需要你看文档，然后就是编程的思维了。Chrome提供的api很多，所以可以实现很多很多功能，具体还有待多多开发。</p><h2 id="吃我一发安利"><a href="#吃我一发安利" aria-hidden="true" class="header-anchor">#</a> 吃我一发安利</h2><p>最后，安利一发我的插件 - 知乎日报Web版。</p><p>插件地址:</p><p><a href="https://chrome.google.com/webstore/detail/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5web%E7%89%88/hgenmoheeaicmomkkkkkoeeihmdpacio" target="_blank" rel="noopener noreferrer">https://chrome.google.com/webstore/detail/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5web%E7%89%88/hgenmoheeaicmomkkkkkoeeihmdpacio</a></p><p>项目地址:</p><p><a href="https://github.com/excaliburhan/zhDaily" target="_blank" rel="noopener noreferrer">https://github.com/excaliburhan/zhDaily</a></p><p>欢迎各位下载试用，反馈功能。Follow或者Star一下项目也不是不可以~~</p></div><!----><!----></div></div></div>
    <script src="/blog/assets/js/17.49b0032e.js" defer></script><script src="/blog/assets/js/app.1f817541.js" defer></script>
  </body>
</html>
