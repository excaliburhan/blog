<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>韩小平的博客 | 如何写好.babelrc？Babel的presets和plugins配置解析</title>
    <meta name="description" content="Just A Coder.">
    
    
    <link rel="preload" href="/blog/assets/css/23.styles.cc8c2f9e.css" as="style"><link rel="preload" href="/blog/assets/js/app.1f817541.js" as="script"><link rel="preload" href="/blog/assets/js/5.9fdd6adc.js" as="script"><link rel="prefetch" href="/blog/assets/js/12.814f811a.js"><link rel="prefetch" href="/blog/assets/js/1.411138db.js"><link rel="prefetch" href="/blog/assets/js/2.6d9529a4.js"><link rel="prefetch" href="/blog/assets/js/3.4fdc0d88.js"><link rel="prefetch" href="/blog/assets/js/4.deae28fa.js"><link rel="prefetch" href="/blog/assets/js/6.00a6ab47.js"><link rel="prefetch" href="/blog/assets/js/7.da4f18c9.js"><link rel="prefetch" href="/blog/assets/js/8.913fdfc3.js"><link rel="prefetch" href="/blog/assets/js/9.edf39113.js"><link rel="prefetch" href="/blog/assets/js/10.2f0c9cf4.js"><link rel="prefetch" href="/blog/assets/js/11.615d4175.js"><link rel="prefetch" href="/blog/assets/js/0.cffbc176.js"><link rel="prefetch" href="/blog/assets/js/13.69b37d45.js"><link rel="prefetch" href="/blog/assets/js/14.a0bb1f94.js"><link rel="prefetch" href="/blog/assets/js/15.9690300e.js"><link rel="prefetch" href="/blog/assets/js/16.d94b26bb.js"><link rel="prefetch" href="/blog/assets/js/17.49b0032e.js"><link rel="prefetch" href="/blog/assets/js/18.53f1b6f9.js"><link rel="prefetch" href="/blog/assets/js/19.49c9af97.js"><link rel="prefetch" href="/blog/assets/js/20.d43d8101.js"><link rel="prefetch" href="/blog/assets/js/21.c6d918ad.js"><link rel="prefetch" href="/blog/assets/js/22.3be36221.js">
    <link rel="stylesheet" href="/blog/assets/css/23.styles.cc8c2f9e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/blog/" class="home-link router-link-active"><!----><span class="site-name">
      韩小平的博客
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/posts/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/links/" class="nav-link">友链</a></div><a href="https://github.com/excaliburhan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/posts/" class="nav-link router-link-active">文章</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/blog/links/" class="nav-link">友链</a></div><a href="https://github.com/excaliburhan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><!----></div><div class="page"><div class="content"><h1 id="如何写好-babelrc？babel的presets和plugins配置解析"><a href="#如何写好-babelrc？babel的presets和plugins配置解析" aria-hidden="true" class="header-anchor">#</a> 如何写好.babelrc？Babel的presets和plugins配置解析</h1><h2 id="什么是babel"><a href="#什么是babel" aria-hidden="true" class="header-anchor">#</a> 什么是Babel</h2><blockquote><p>The compiler for writing next generation JavaScript.</p></blockquote><p>官网是这么说的，翻译一下就是下一代JavaScript 语法的编译器。</p><p>作为前端开发，由于浏览器的版本和兼容性问题，很多JavaScript的新的方法都不能使用，等到可以大胆使用的时候，可能已经过去了好几年。Babel就因此而生，它可以让你放心使用大部分的JavaScript的新的标准的方法，然后编译成兼容绝大多数的主流浏览器的代码。</p><p>在升级到了Babel6.x版本之后，所有的插件都是可插拔的。这也意味着你安装了Babel之后，是不能工作的，需要配置对应的.babelrc文件才能发挥完整的作用。下面就对Babel的presets和plugins配置做一个简单解析。</p><p>所有配置根据<a href="https://babeljs.io/docs/plugins/" target="_blank" rel="noopener noreferrer">官方文档</a>提供，更新时间：2016-12-05。</p><h2 id="预设-presets"><a href="#预设-presets" aria-hidden="true" class="header-anchor">#</a> 预设(presets)</h2><p>使用的时候需要安装对应的插件，对应babel-preset-xxx，例如下面的配置，需要<code>npm install babel-preset-es2015</code>。</p><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;es2015&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="env"><a href="#env" aria-hidden="true" class="header-anchor">#</a> env</h3><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><p>最近新增的一个选项，有以下options选择。</p><h4 id="targets-string-number-，默认"><a href="#targets-string-number-，默认" aria-hidden="true" class="header-anchor">#</a> targets: { [string]: number }，默认{}</h4><p>需要支持的环境，可选例如：chrome, edge, firefox, safari, ie, ios, node，甚至可以制定版本，如node: 6.5。也使用node: current代表使用当前的版本。</p><h4 id="browsers-array-string-string，默认"><a href="#browsers-array-string-string，默认" aria-hidden="true" class="header-anchor">#</a> browsers: Array&lt;string&gt; | string，默认[]</h4><p>浏览器列表，使用的是<a href="https://github.com/ai/browserslist" target="_blank" rel="noopener noreferrer">browserslist</a>，可选例如：last 2 versions, &gt; 5%。</p><h4 id="loose-boolean，默认false"><a href="#loose-boolean，默认false" aria-hidden="true" class="header-anchor">#</a> loose: boolean，默认false</h4><p>是否使用宽松模式，如果设置为true，plugins里的插件如果允许，都会采用宽松模式。</p><h4 id="debug-boolean，默认false"><a href="#debug-boolean，默认false" aria-hidden="true" class="header-anchor">#</a> debug: boolean，默认false</h4><p>编译是否会去掉console.log。</p><h4 id="whitelist-array-string-，默认"><a href="#whitelist-array-string-，默认" aria-hidden="true" class="header-anchor">#</a> whitelist: Array&lt;string&gt;，默认[]</h4><p>设置一直引入的plugins列表。</p><h3 id="es2015-es2016-es2017-latest"><a href="#es2015-es2016-es2017-latest" aria-hidden="true" class="header-anchor">#</a> es2015/es2016/es2017/latest</h3><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;es2015&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="es2015"><a href="#es2015" aria-hidden="true" class="header-anchor">#</a> es2015</h4><p>使用es2015的，也就是我们常说的es6的相关方法，简单翻译如下，更多细节可以参看<a href="https://babeljs.io/docs/plugins/preset-es2015/" target="_blank" rel="noopener noreferrer">文档</a>。</p><ul><li>check-es2015-constants // 检验const常量是否被重新赋值</li><li>transform-es2015-arrow-functions // 编译箭头函数</li><li>transform-es2015-block-scoped-functions // 函数声明在作用域内</li><li>transform-es2015-block-scoping // 编译const和let</li><li>transform-es2015-classes // 编译class</li><li>transform-es2015-computed-properties // 编译计算对象属性</li><li>transform-es2015-destructuring // 编译解构赋值</li><li>transform-es2015-duplicate-keys // 编译对象中重复的key，其实是转换成计算对象属性</li><li>transform-es2015-for-of // 编译for...of</li><li>transform-es2015-function-name // 将function.name语义应用于所有的function</li><li>transform-es2015-literals // 编译整数(8进制/16进制)和unicode</li><li>transform-es2015-modules-commonjs // 将modules编译成commonjs</li><li>transform-es2015-object-super // 编译super</li><li>transform-es2015-parameters // 编译参数，包括默认参数，不定参数和解构参数</li><li>transform-es2015-shorthand-properties // 编译属性缩写</li><li>transform-es2015-spread // 编译展开运算符</li><li>transform-es2015-sticky-regex // 正则添加sticky属性</li><li>transform-es2015-template-literals // 编译模版字符串</li><li>transform-es2015-typeof-symbol // 编译Symbol类型</li><li>transform-es2015-unicode-regex // 正则添加unicode模式</li><li>transform-regenerator // 编译generator函数</li></ul><p>总结：常用的都覆盖了，并不需要太关心内容，如果使用某些还不支持的语法导致报错，可以回头查一下支持的列表。</p><h4 id="es2016"><a href="#es2016" aria-hidden="true" class="header-anchor">#</a> es2016</h4><p>使用es2016的相关插件，也就是es7，更多细节可以参看<a href="https://babeljs.io/docs/plugins/preset-es2016/" target="_blank" rel="noopener noreferrer">文档</a>。</p><ul><li>transform-exponentiation-operator // 编译幂运算符</li></ul><h4 id="es2017"><a href="#es2017" aria-hidden="true" class="header-anchor">#</a> es2017</h4><p>使用es2017的相关插件，也就是es8？，更多细节可以参看<a href="https://babeljs.io/docs/plugins/preset-es2017/" target="_blank" rel="noopener noreferrer">文档</a>。</p><ul><li>syntax-trailing-function-commas // function最后一个参数允许使用逗号</li><li>transform-async-to-generator // 把async函数转化成generator函数</li></ul><h4 id="latest"><a href="#latest" aria-hidden="true" class="header-anchor">#</a> latest</h4><p>latest是一个特殊的presets，包括了es2015，es2016，es2017的插件（目前为止，以后有es2018也会包括进去）。</p><h3 id="react"><a href="#react" aria-hidden="true" class="header-anchor">#</a> react</h3><p>react是一个比较特别的官方推荐的presets，大概是因为比较火吧。加入了flow，jsx等语法，具体可以看<a href="https://babeljs.io/docs/plugins/preset-react/" target="_blank" rel="noopener noreferrer">文档</a>。</p><h3 id="stage-x-stage-0-1-2-3-4"><a href="#stage-x-stage-0-1-2-3-4" aria-hidden="true" class="header-anchor">#</a> stage-x(stage-0/1/2/3/4)</h3><p>stage-x和上面的es2015等有些类似，但是它是按照JavaScript的提案阶段区分的，一共有5个阶段。而数字越小，阶段越靠后，存在依赖关系。也就是说stage-0是包括stage-1的，以此类推。</p><h4 id="stage-4"><a href="#stage-4" aria-hidden="true" class="header-anchor">#</a> stage-4</h4><p>已完成的提案，与年度发布的release有关，包含2015年到明年正式发布的内容。例如，现在是2016年，stage-4应该是包括es2015，es2016，es2017。经过测试，babel-preset-stage-4这个npm包是不存在的，如果你单纯的需要stage-4的相关方法，需要引入es2015~es2017的presets。</p><h4 id="stage-3"><a href="#stage-3" aria-hidden="true" class="header-anchor">#</a> stage-3</h4><p>除了stage-4的内容，还包括以下插件，更多细节请看<a href="http://babeljs.io/docs/plugins/preset-stage-3/" target="_blank" rel="noopener noreferrer">文档</a>。</p><ul><li>transform-object-rest-spread // 编译对象的解构赋值和不定参数</li><li>transform-async-generator-functions // 将async generator function和for await编译为es2015的generator。</li></ul><h4 id="stage-2"><a href="#stage-2" aria-hidden="true" class="header-anchor">#</a> stage-2</h4><p>除了stage-3的内容，还包括以下插件，更多细节请看<a href="http://babeljs.io/docs/plugins/preset-stage-2/" target="_blank" rel="noopener noreferrer">文档</a>。</p><ul><li>transform-class-properties // 编译静态属性(es2015)和属性初始化语法声明的属性(es2016)。</li></ul><h4 id="stage-1"><a href="#stage-1" aria-hidden="true" class="header-anchor">#</a> stage-1</h4><p>除了stage-2的内容，还包括以下插件，更多细节请看<a href="http://babeljs.io/docs/plugins/preset-stage-1/" target="_blank" rel="noopener noreferrer">文档</a>。</p><ul><li>transform-class-constructor-call // 编译class中的constructor，在Babel7中会被移除</li><li>transform-export-extensions // 编译额外的exprt语法，如export * as ns from &quot;mod&quot;;细节可以看<a href="https://github.com/leebyron/ecmascript-more-export-from" target="_blank" rel="noopener noreferrer">这个</a></li></ul><h4 id="stage-0"><a href="#stage-0" aria-hidden="true" class="header-anchor">#</a> stage-0</h4><p>除了stage-1的内容，还包括以下插件，更多细节请看<a href="http://babeljs.io/docs/plugins/preset-stage-0/" target="_blank" rel="noopener noreferrer">文档</a>。</p><ul><li>transform-do-expressions // 编译do表达式</li><li>transform-function-bind // 编译bind运算符，也就是<code>::</code></li></ul><h2 id="插件-plugins"><a href="#插件-plugins" aria-hidden="true" class="header-anchor">#</a> 插件(plugins)</h2><p>其实看了上面的应该也明白了，presets，也就是一堆plugins的预设，起到方便的作用。如果你不采用presets，完全可以单独引入某个功能，比如以下的设置就会引入编译箭头函数的功能。</p><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-es2015-arrow-functions&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><p>那么，还有一些方法是presets中不提供的，这时候就需要单独引入了，介绍几个常见的插件。</p><h3 id="transform-runtime"><a href="#transform-runtime" aria-hidden="true" class="header-anchor">#</a> transform-runtime</h3><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-runtime&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><p>主要有以下options选择。</p><h4 id="helpers-boolean，默认true"><a href="#helpers-boolean，默认true" aria-hidden="true" class="header-anchor">#</a> helpers: boolean，默认true</h4><p>使用babel的helper函数。</p><h4 id="polyfill-boolean，默认true"><a href="#polyfill-boolean，默认true" aria-hidden="true" class="header-anchor">#</a> polyfill: boolean，默认true</h4><p>使用babel的polyfill，但是不能完全取代babel-polyfill。</p><h4 id="regenerator-boolean，默认true"><a href="#regenerator-boolean，默认true" aria-hidden="true" class="header-anchor">#</a> regenerator: boolean，默认true</h4><p>使用babel的regenerator。</p><h4 id="modulename-string，默认babel-runtime"><a href="#modulename-string，默认babel-runtime" aria-hidden="true" class="header-anchor">#</a> moduleName: string，默认babel-runtime</h4><p>使用对应module处理。</p><p>这里的options一般不用自己设置，用默认的即可。这个插件最大的作用主要有几下几点：</p><ul><li>解决编译中产生的重复的工具函数，减小代码体积</li><li>非实例方法的poly-fill，如<code>Object.assign</code>，但是实例方法不支持，如<code>&quot;foobar&quot;.includes(&quot;foo&quot;)</code>，这时候需要单独引入babel-polyfill</li></ul><p>更多细节参见<a href="https://babeljs.io/docs/plugins/transform-runtime/" target="_blank" rel="noopener noreferrer">文档</a>。</p><h3 id="transform-remove-console"><a href="#transform-remove-console" aria-hidden="true" class="header-anchor">#</a> transform-remove-console</h3><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-remove-console&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><p>使用这个插件，编译后的代码都会移除<code>console.*</code>，妈妈再也不用担心线上代码有多余的console.log了。当然很多时候，我们如果使用webpack，会在webpack中配置。</p><p>这也告诉我们，Babel不仅仅是编译代码的工具，还能对代码进行压缩，也许有一天，你不再需要代码压缩的插件了，因为你有了Babel！</p><h2 id="自定义预设或插件"><a href="#自定义预设或插件" aria-hidden="true" class="header-anchor">#</a> 自定义预设或插件</h2><p>Babel支持自定义的预设(presets)或插件(plugins)。如果你的插件在npm上，可以直接采用这种方式<code>&quot;plugins&quot;: [&quot;babel-plugin-myPlugin&quot;]</code>，当然，你也可以缩写，它和<code>&quot;plugins&quot;: [&quot;myPlugin&quot;]</code>是等价的。此外，你还可以采用本地的相对路径引入插件，比如<code>&quot;plugins&quot;: [&quot;./node_modules/asdf/plugin&quot;]</code>。</p><p>presets同理。</p><h2 id="plugins-presets排序"><a href="#plugins-presets排序" aria-hidden="true" class="header-anchor">#</a> plugins/presets排序</h2><p>也许你会问，或者你没注意到，我帮你问了，plugins和presets编译，也许会有相同的功能，或者有联系的功能，按照怎么的顺序进行编译？答案是会按照一定的顺序。</p><ul><li>具体而言，plugins优先于presets进行编译。</li><li>plugins按照数组的index增序(从数组第一个到最后一个)进行编译。</li><li>presets按照数组的index倒序(从数组最后一个到第一个)进行编译。因为作者认为大部分会把presets写成<code>[&quot;es2015&quot;, &quot;stage-0&quot;]</code>。具体细节可以看<a href="https://github.com/babel/notes/blob/master/2016-08/august-01.md#potential-api-changes-for-traversal" target="_blank" rel="noopener noreferrer">这个</a>。</li></ul><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2><p>因为自己对.babelrc文件的设置有点疑问，花了大半天撸了下官方的<a href="https://babeljs.io/docs/plugins/" target="_blank" rel="noopener noreferrer">文档</a>。很多内容是英文的，可能翻译并不准确，希望大家多多指教。</p><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;es2015&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;stage-0&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-runtime&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><p>这是我写了半天发现比较推荐的配置(真的是太简单了，还花了这么久去看文档)。强烈推荐使用<code>transform-runtime</code>。</p><p>当然，如果你的项目需要react或者flow这些语法的编译，请在presets里加入对应的值即可。如果你需要非实例方法<code>&quot;foobar&quot;.includes(&quot;foo&quot;)</code>之类的方法，按需引入babel-polyfill。</p></div><!----><!----></div></div></div>
    <script src="/blog/assets/js/5.9fdd6adc.js" defer></script><script src="/blog/assets/js/app.1f817541.js" defer></script>
  </body>
</html>
